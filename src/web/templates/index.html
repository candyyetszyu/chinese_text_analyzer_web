<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Text Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
    <div class="container-fluid mt-4">
        <header class="text-center mb-4">
            <h1>Chinese Text Analyzer</h1>
            <p class="lead">中文文本分析工具</p>
        </header>

        <div class="row">
            <!-- Left panel - Input area -->
            <div class="col-md-5">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <ul class="nav nav-tabs card-header-tabs" id="inputTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="analyze-tab" data-bs-toggle="tab" data-bs-target="#analyze" type="button" role="tab">文本分析</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="convert-tab" data-bs-toggle="tab" data-bs-target="#convert" type="button" role="tab">繁簡轉換</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="similarity-tab" data-bs-toggle="tab" data-bs-target="#similarity" type="button" role="tab">相似度分析</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="file-upload-tab" data-bs-toggle="tab" data-bs-target="#file-upload" type="button" role="tab">文件上傳</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="inputTabContent">
                            <!-- 文本分析面板 -->
                            <div class="tab-pane fade show active" id="analyze" role="tabpanel">
                                <div class="mb-3">
                                    <textarea id="analyzeText" class="form-control" rows="10" placeholder="請輸入要分析的中文文本"></textarea>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <button id="analyzeBtn" class="btn btn-primary">
                                            <i class="bi bi-bar-chart-line"></i> 分析文本
                                        </button>
                                        <button id="loadSampleBtn" class="btn btn-outline-secondary ms-2">
                                            <i class="bi bi-file-text"></i> 載入範例
                                        </button>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="generateReportSwitch" checked>
                                        <label class="form-check-label" for="generateReportSwitch">生成完整報告</label>
                                    </div>
                                </div>
                                
                                <div id="loadingIndicator" class="mt-3 d-none">
                                    <div class="d-flex align-items-center">
                                        <div class="spinner-border spinner-border-sm text-primary me-2" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <span>分析中，請稍候...</span>
                                    </div>
                                    <div class="progress mt-2">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 繁簡轉換面板 -->
                            <div class="tab-pane fade" id="convert" role="tabpanel">
                                <div class="mb-3">
                                    <textarea id="sourceText" class="form-control" rows="8" placeholder="請輸入要轉換的文本"></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="conversionDirection" id="toTraditional" value="to_traditional" checked>
                                        <label class="form-check-label" for="toTraditional">轉繁體</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="conversionDirection" id="toSimplified" value="to_simplified">
                                        <label class="form-check-label" for="toSimplified">轉簡體</label>
                                    </div>
                                </div>
                                
                                <button id="convertBtn" class="btn btn-primary">
                                    <i class="bi bi-translate"></i> 轉換
                                </button>
                                
                                <div class="mb-3 mt-4">
                                    <label for="resultText" class="form-label">轉換結果</label>
                                    <textarea id="resultText" class="form-control" rows="8" readonly></textarea>
                                </div>
                                <div>
                                    <button id="copyBtn" class="btn btn-outline-secondary">
                                        <i class="bi bi-clipboard"></i> 複製結果
                                    </button>
                                    <button id="downloadBtn" class="btn btn-outline-success ms-2">
                                        <i class="bi bi-download"></i> 下載結果
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 相似度分析面板 -->
                            <div class="tab-pane fade" id="similarity" role="tabpanel">
                                <div class="mb-3">
                                    <label for="similarityTexts" class="form-label">輸入多個文本進行相似度分析（每行一個文本）</label>
                                    <textarea id="similarityTexts" class="form-control" rows="8" placeholder="文本1&#10;文本2&#10;文本3&#10;..."></textarea>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <button id="similarityAnalyzeBtn" class="btn btn-primary">
                                            <i class="bi bi-diagram-3"></i> 分析相似度
                                        </button>
                                        <button id="loadSimilarityExampleBtn" class="btn btn-outline-secondary ms-2">
                                            <i class="bi bi-file-text"></i> 載入範例
                                        </button>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="generateInteractiveVizSwitch" checked>
                                        <label class="form-check-label" for="generateInteractiveVizSwitch">生成交互式圖表</label>
                                    </div>
                                </div>
                                
                                <div id="similarityLoadingIndicator" class="mt-3 d-none">
                                    <div class="d-flex align-items-center">
                                        <div class="spinner-border spinner-border-sm text-primary me-2" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <span>分析中，請稍候...</span>
                                    </div>
                                    <div class="progress mt-2">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 文件上傳面板 -->
                            <div class="tab-pane fade" id="file-upload" role="tabpanel">
                                <div class="mb-3">
                                    <label for="fileInput" class="form-label">選擇文件進行分析</label>
                                    <input type="file" class="form-control" id="fileInput" accept=".txt,.pdf,.docx,.doc,.html,.htm,.md,.csv,.json">
                                    <div class="form-text">支持格式：TXT, PDF, Word, HTML, Markdown, CSV, JSON</div>
                                </div>
                                
                                <div class="mb-3">
                                    <button id="uploadFileBtn" class="btn btn-primary">
                                        <i class="bi bi-cloud-upload"></i> 上傳並分析
                                    </button>
                                    <button id="checkCapabilitiesBtn" class="btn btn-outline-info ms-2">
                                        <i class="bi bi-info-circle"></i> 檢查系統功能
                                    </button>
                                </div>
                                
                                <div id="fileUploadProgress" class="mt-3 d-none">
                                    <div class="d-flex align-items-center">
                                        <div class="spinner-border spinner-border-sm text-primary me-2" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <span>上傳並解析中...</span>
                                    </div>
                                    <div class="progress mt-2">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                                    </div>
                                </div>
                                
                                <div id="fileParseResult" class="mt-3 d-none">
                                    <div class="card">
                                        <div class="card-header bg-light">
                                            <h5 class="card-title mb-0">解析結果</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="fileMetadata" class="mb-3"></div>
                                            <div>
                                                <button id="analyzeFileContentBtn" class="btn btn-success">
                                                    <i class="bi bi-bar-chart-line"></i> 分析解析的內容
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right panel - Results area -->
            <div class="col-md-7">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="resultTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab">基本分析</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button" role="tab">進階分析</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab">數據表格</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="interactive-tab" data-bs-toggle="tab" data-bs-target="#interactive" type="button" role="tab">交互式圖表</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="report-tab" data-bs-toggle="tab" data-bs-target="#report" type="button" role="tab">完整報告</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="similarity-results-tab" data-bs-toggle="tab" data-bs-target="#similarity-results" type="button" role="tab">相似度結果</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div id="analysisResults" class="d-none">
                            <div class="tab-content" id="resultTabContent">
                                <!-- 基本分析 -->
                                <div class="tab-pane fade show active" id="basic" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-12 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">詞頻雲圖 <a href="#" class="download-link" data-viz="wordcloud"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="wordcloudImg" class="img-fluid viz-img" src="" alt="詞雲圖">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">詞頻分布 <a href="#" class="download-link" data-viz="word_frequency"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="wordFreqImg" class="img-fluid viz-img" src="" alt="詞頻分佈圖">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">詞性分布 <a href="#" class="download-link" data-viz="pos_distribution"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="posDistImg" class="img-fluid viz-img" src="" alt="詞性分佈圖">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">情感分析 <a href="#" class="download-link" data-viz="sentiment"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="sentimentImg" class="img-fluid viz-img" src="" alt="情感分析圖">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">命名實體 <a href="#" class="download-link" data-viz="entities"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="entitiesImg" class="img-fluid viz-img" src="" alt="命名實體圖">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 進階分析 -->
                                <div class="tab-pane fade" id="advanced" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">詞頻垂直分布 <a href="#" class="download-link" data-viz="word_frequency_vertical"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="wordFreqVerticalImg" class="img-fluid viz-img" src="" alt="詞頻垂直分佈圖">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">詞頻餅圖 <a href="#" class="download-link" data-viz="word_frequency_pie"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="wordFreqPieImg" class="img-fluid viz-img" src="" alt="詞頻餅圖">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">關鍵詞權重 <a href="#" class="download-link" data-viz="keywords"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="keywordsImg" class="img-fluid viz-img" src="" alt="關鍵詞權重圖">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">常見詞組 (N-grams) <a href="#" class="download-link" data-viz="ngrams"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="ngramsImg" class="img-fluid viz-img" src="" alt="N-gram詞組分析圖">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">詞語長度排序 <a href="#" class="download-link" data-viz="word_by_length"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="wordLengthImg" class="img-fluid viz-img" src="" alt="詞長排序圖">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 數據表格 -->
                                <div class="tab-pane fade" id="data" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h5 class="card-title mb-0">詞頻統計</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div id="wordFrequencyList" style="max-height: 300px; overflow-y: auto;"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h5 class="card-title mb-0">詞性分布</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div id="posDistribution" style="max-height: 300px; overflow-y: auto;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h5 class="card-title mb-0">命名實體識別</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div id="namedEntities" style="max-height: 300px; overflow-y: auto;"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h5 class="card-title mb-0">情感分析</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div id="sentimentAnalysis"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h5 class="card-title mb-0">關鍵詞權重</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div id="keywordsList" style="max-height: 300px; overflow-y: auto;"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h5 class="card-title mb-0">常見詞組 (N-grams)</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div id="ngramsList" style="max-height: 300px; overflow-y: auto;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 完整報告 -->
                                <div class="tab-pane fade" id="report" role="tabpanel">
                                    <div class="report-container">
                                        <div class="text-center mb-4" id="reportLoading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">正在生成報告，請稍候...</p>
                                        </div>
                                        
                                        <div id="reportContent" class="d-none">
                                            <div class="alert alert-success mb-4">
                                                <h5 class="alert-heading"><i class="bi bi-file-earmark-richtext"></i> 報告已生成！</h5>
                                                <p class="mb-0">您可以選擇在線查看或下載完整的分析報告。</p>
                                            </div>
                                            
                                            <div class="d-flex justify-content-center gap-3 mb-4">
                                                <a href="#" id="viewReportBtn" class="btn btn-primary" target="_blank">
                                                    <i class="bi bi-eye"></i> 在線查看報告
                                                </a>
                                                <a href="#" id="downloadReportBtn" class="btn btn-success" download>
                                                    <i class="bi bi-download"></i> 下載報告
                                                </a>
                                                <button id="downloadAllVisualizationsBtn" class="btn btn-secondary">
                                                    <i class="bi bi-images"></i> 下載所有圖表
                                                </button>
                                            </div>
                                            
                                                                        <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <h5 class="card-title mb-0">基本統計</h5>
                                </div>
                                <div class="card-body">
                                    <ul id="reportStats" class="list-group list-group-flush">
                                        <!-- Will be filled with statistics -->
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- 交互式報告預覽 -->
                            <div class="card mb-3" id="interactiveReportPreview">
                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-0">交互式圖表</h5>
                                    <button class="btn btn-sm btn-outline-primary" onclick="document.getElementById('interactive-tab').click()">
                                        <i class="bi bi-graph-up"></i> 查看詳細
                                    </button>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted mb-2">包含交互式圖表：熱力圖、網絡圖、樹狀圖、儀表板</p>
                                    <div class="row" id="interactiveReportThumbnails">
                                        <!-- Thumbnails will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 相似度結果預覽 -->
                            <div class="card mb-3" id="similarityReportPreview">
                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-0">相似度分析</h5>
                                    <button class="btn btn-sm btn-outline-primary" onclick="document.getElementById('similarity-results-tab').click()">
                                        <i class="bi bi-diagram-3"></i> 查看詳細
                                    </button>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted mb-2">文本相似度比較、熱力圖、網絡關係圖</p>
                                    <div class="row" id="similarityReportThumbnails">
                                        <!-- Similarity thumbnails will be populated here -->
                                    </div>
                                </div>
                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 相似度分析結果 -->
                            <div class="tab-pane fade" id="similarity-results" role="tabpanel">
                                <div id="similarityResultsContent" class="d-none">
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">相似度熱力圖 <a href="#" class="download-link" data-viz="similarity_heatmap"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="similarityHeatmapImg" class="img-fluid viz-img" src="" alt="相似度熱力圖">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="viz-container">
                                                <h5 class="viz-title">相似度網絡圖 <a href="#" class="download-link" data-viz="similarity_network"><i class="bi bi-download"></i></a></h5>
                                                <div class="viz-content text-center">
                                                    <img id="similarityNetworkImg" class="img-fluid viz-img" src="" alt="相似度網絡圖">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-12 mb-4">
                                            <div class="card">
                                                <div class="card-header bg-light">
                                                    <h5 class="card-title mb-0">相似度矩陣</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div id="similarityMatrix" style="max-height: 400px; overflow-y: auto;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="noSimilarityResults" class="text-center py-5">
                                    <i class="bi bi-diagram-3" style="font-size: 4rem; color: #dee2e6;"></i>
                                    <h4 class="mt-3">尚未進行相似度分析</h4>
                                    <p class="text-muted">請在左側輸入多個文本並點擊「分析相似度」按鈕</p>
                                </div>
                            </div>
                            
                            <!-- 交互式圖表 -->
                            <div class="tab-pane fade" id="interactive" role="tabpanel">
                                <div id="interactiveVizContent" class="d-none">
                                    <!-- Note about visualizations -->
                                    <div id="visualizationNote" class="alert alert-info mb-4">
                                        <h6><i class="bi bi-info-circle"></i> 關於交互式圖表</h6>
                                        <p class="mb-0">
                                            <strong>單文本分析：</strong>生成詞性-詞頻熱力圖和詞語關聯網絡圖<br>
                                            <strong>相似度分析：</strong>生成文本相似度熱力圖和文本關係網絡圖
                                        </p>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-12 mb-4">
                                            <div class="card">
                                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                                    <h5 class="card-title mb-0">交互式熱力圖</h5>
                                                    <span class="badge bg-secondary" id="heatmapStatus">等待生成</span>
                                                    <a href="#" id="openInteractiveHeatmapBtn" class="btn btn-sm btn-outline-primary d-none" target="_blank">
                                                        <i class="bi bi-box-arrow-up-right"></i> 在新窗口打開
                                                    </a>
                                                </div>
                                                <div class="card-body">
                                                    <div id="heatmapPlaceholder" class="text-center py-5">
                                                        <i class="bi bi-grid-3x3-gap" style="font-size: 3rem; color: #dee2e6;"></i>
                                                        <p class="text-muted mt-3">完成文本分析後點擊「生成交互式圖表」按鈕</p>
                                                        <button class="btn btn-outline-primary" onclick="document.getElementById('generateInteractiveVizBtn').click()">
                                                            <i class="bi bi-magic"></i> 生成交互式圖表
                                                        </button>
                                                    </div>
                                                    <iframe id="interactiveHeatmapFrame" class="w-100 d-none" height="500" frameborder="0"></iframe>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-12 mb-4">
                                            <div class="card">
                                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                                    <h5 class="card-title mb-0">交互式網絡圖</h5>
                                                    <span class="badge bg-secondary" id="networkStatus">等待生成</span>
                                                    <a href="#" id="openInteractiveNetworkBtn" class="btn btn-sm btn-outline-primary d-none" target="_blank">
                                                        <i class="bi bi-box-arrow-up-right"></i> 在新窗口打開
                                                    </a>
                                                </div>
                                                <div class="card-body">
                                                    <div id="networkPlaceholder" class="text-center py-5">
                                                        <i class="bi bi-diagram-3" style="font-size: 3rem; color: #dee2e6;"></i>
                                                        <p class="text-muted mt-3">完成文本分析後點擊「生成交互式圖表」按鈕</p>
                                                        <button class="btn btn-outline-primary" onclick="document.getElementById('generateInteractiveVizBtn').click()">
                                                            <i class="bi bi-magic"></i> 生成交互式圖表
                                                        </button>
                                                    </div>
                                                    <iframe id="interactiveNetworkFrame" class="w-100 d-none" height="500" frameborder="0"></iframe>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-12 mb-4">
                                            <div class="card">
                                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                                    <h5 class="card-title mb-0">詞頻樹狀圖</h5>
                                                    <a href="#" id="openTreemapBtn" class="btn btn-sm btn-outline-primary" target="_blank">
                                                        <i class="bi bi-box-arrow-up-right"></i> 在新窗口打開
                                                    </a>
                                                </div>
                                                <div class="card-body">
                                                    <iframe id="treemapFrame" class="w-100" height="500" frameborder="0"></iframe>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-12 mb-4">
                                            <div class="card">
                                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                                    <h5 class="card-title mb-0">綜合分析儀表板</h5>
                                                    <a href="#" id="openDashboardBtn" class="btn btn-sm btn-outline-primary" target="_blank">
                                                        <i class="bi bi-box-arrow-up-right"></i> 在新窗口打開
                                                    </a>
                                                </div>
                                                <div class="card-body">
                                                    <iframe id="dashboardFrame" class="w-100" height="600" frameborder="0"></iframe>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                                <div id="noInteractiveViz" class="text-center py-5">
                    <i class="bi bi-graph-up" style="font-size: 4rem; color: #dee2e6;"></i>
                    <h4 class="mt-3">尚未生成交互式圖表</h4>
                    <p class="text-muted">完成文本分析後會自動生成交互式圖表</p>
                    <button id="generateInteractiveVizBtn" class="btn btn-primary mt-2 d-none">
                        <i class="bi bi-magic"></i> 生成交互式圖表
                    </button>
                </div>
                            </div>
                            
                            <!-- Download options fixed at the bottom -->
                            <div class="download-panel mt-3 d-flex justify-content-between align-items-center">
                                <div class="total-stats">
                                    <span class="badge rounded-pill bg-primary me-2" id="totalWordsBadge">總詞數: 0</span>
                                    <span class="badge rounded-pill bg-info me-2" id="avgWordLengthBadge">平均詞長: 0</span>
                                    <span class="badge rounded-pill" id="sentimentBadge">情感: 未知</span>
                                </div>
                                <div class="download-options">
                                    <div class="dropdown d-inline-block">
                                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="downloadDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-download"></i> 下載選項
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="downloadDropdown">
                                            <li><a class="dropdown-item" href="#" id="downloadBasicVisualizationsBtn">下載基本圖表</a></li>
                                            <li><a class="dropdown-item" href="#" id="downloadAdvancedVisualizationsBtn">下載進階圖表</a></li>
                                            <li><a class="dropdown-item" href="#" id="downloadDataAsJson">下載數據 (JSON)</a></li>
                                            <li><a class="dropdown-item" href="#" id="downloadDataAsCsv">下載數據 (CSV)</a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item" href="#" id="downloadEverythingBtn">下載所有內容</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Initial empty state -->
                        <div id="emptyState" class="text-center py-5">
                            <i class="bi bi-bar-chart-line" style="font-size: 4rem; color: #dee2e6;"></i>
                            <h4 class="mt-3">尚未分析任何文本</h4>
                            <p class="text-muted">請在左側輸入中文文本並點擊「分析文本」按鈕</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for large image preview -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel">圖表預覽</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalImage" class="img-fluid" src="" alt="大圖預覽">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                    <a href="#" id="downloadModalImageBtn" class="btn btn-primary" download>下載圖片</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>